# üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

## Local Bot API: –û—à–∏–±–∫–∞ "Not Found" –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞:
```
telegram.error.InvalidToken: Not Found
HTTP/1.1 404 Not Found
```

### –ü—Ä–∏—á–∏–Ω–∞:
Local Bot API Server –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª—ã, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Telegram API. –≠—Ç–æ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ.

### ‚úÖ –†–µ—à–µ–Ω–∏–µ 1: –û—Ç–∫–ª—é—á–∏—Ç—å Local API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Telegram API —Å –ª–∏–º–∏—Ç–æ–º 20 MB:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `.env`
2. –ò–∑–º–µ–Ω–∏—Ç–µ:
   ```env
   USE_LOCAL_API=false
   MAX_FILE_SIZE_MB=20
   ```

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç:
   ```bash
   docker-compose restart telegram-audio-bot
   ```

–¢–µ–ø–µ—Ä—å –±–æ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º API Telegram.

### ‚úÖ –†–µ—à–µ–Ω–∏–µ 2: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Local API

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ –¥–æ 2000 MB –Ω—É–∂–Ω–æ:

1. **Logout –±–æ—Ç–∞ –æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ API**:
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ—Ç–æ–¥ `logOut` —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather)
   - –ò–ª–∏ —á–µ—Ä–µ–∑ API: `https://api.telegram.org/bot<TOKEN>/logOut`

2. **–û—á–∏—Å—Ç–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ Bot API Server**:
   ```bash
   docker-compose down
   docker volume rm my-audio-bot_telegram-bot-api-data
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ**:
   ```bash
   docker-compose up -d
   ```

4. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ù–û–í–´–ô —Ñ–∞–π–ª –±–æ—Ç—É** - —Ç–µ–ø–µ—Ä—å –æ–Ω –±—É–¥–µ—Ç —á–µ—Ä–µ–∑ Local API

### ‚úÖ –†–µ—à–µ–Ω–∏–µ 3: –ì–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ–∂–∏–º

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π API –¥–ª—è —Ñ–∞–π–ª–æ–≤ <20 MB, Local API –¥–ª—è –±–æ–ª—å—à–∏—Ö:

```env
USE_LOCAL_API=false  # –î–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
MAX_FILE_SIZE_MB=20   # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ª–∏–º–∏—Ç
```

–ö–æ–≥–¥–∞ –Ω—É–∂–Ω—ã —Ñ–∞–π–ª—ã >20 MB - –≤–∫–ª—é—á–∏—Ç–µ Local API.

## –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```bash
docker-compose ps
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
- `telegram-bot-api` - Up
- `telegram-audio-bot-pro` - Up

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –õ–æ–≥–∏
```bash
# –õ–æ–≥–∏ –±–æ—Ç–∞
docker-compose logs telegram-audio-bot

# –õ–æ–≥–∏ Bot API Server
docker-compose logs telegram-bot-api
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env`:
```env
BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω     # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!
TELEGRAM_API_ID=123     # –¢–æ–ª—å–∫–æ –¥–ª—è Local API
TELEGRAM_API_HASH=abc   # –¢–æ–ª—å–∫–æ –¥–ª—è Local API
```

## –û—à–∏–±–∫–∞ "dependency failed to start"

–≠—Ç–æ –±—ã–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å healthcheck. –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –≤–µ—Ä—Å–∏–∏ 2.5+.

–û–±–Ω–æ–≤–∏—Ç–µ:
```bash
git pull origin main
docker-compose down
docker-compose up -d --build
```

## –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤

### –†–µ—à–µ–Ω–∏–µ:
–£–≤–µ–ª–∏—á—å—Ç–µ —Ä–µ—Å—É—Ä—Å—ã –≤ `docker-compose.yml`:

```yaml
deploy:
  resources:
    limits:
      memory: 4G    # –ë—ã–ª–æ 2G
      cpus: '4'     # –ë—ã–ª–æ 2
```

## –ë–æ—Ç –∫—Ä–∞—à–∏—Ç—Å—è –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–∞—Ö

### –î–ª—è —Ñ–∞–π–ª–æ–≤ >20 MB:
- –ù—É–∂–µ–Ω Local Bot API (—Å–º. –≤—ã—à–µ)

### –î–ª—è —Ñ–∞–π–ª–æ–≤ >100 MB:
–£–≤–µ–ª–∏—á—å—Ç–µ `MAX_FILE_SIZE_MB`:
```env
MAX_FILE_SIZE_MB=500
```

### –î–ª—è —Ñ–∞–π–ª–æ–≤ >500 MB:
–£–≤–µ–ª–∏—á—å—Ç–µ –ø–∞–º—è—Ç—å Docker:
```yaml
limits:
  memory: 4G  # –ú–∏–Ω–∏–º—É–º
```

## –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```env
CLEANUP_INTERVAL_MINUTES=30   # –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—á–∏—Å—Ç–∫–∏
TEMP_FILE_MAX_AGE_HOURS=2     # –í–æ–∑—Ä–∞—Å—Ç —Ñ–∞–π–ª–æ–≤
```

–í—Ä—É—á–Ω—É—é –æ—á–∏—Å—Ç–∏—Ç–µ:
```bash
docker exec telegram-audio-bot-pro rm -rf /app/temp/*
```

## –ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ–æ—Ä–º–∞—Ç–∞–º–∏

### MP3 –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è:
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ ffmpeg —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (—É–∂–µ –µ—Å—Ç—å –≤ Dockerfile).

### FLAC —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π:
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ MP3 –∏–ª–∏ OGG:
```
–§–∞–π–ª ‚Üí –í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç ‚Üí MP3
```

## –ü–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [README.md](README.md)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [LOCAL_API_SETUP.md](LOCAL_API_SETUP.md)
3. –°–æ–∑–¥–∞–π—Ç–µ Issue: https://github.com/Jefferssonn/my-audio-bot/issues

## –ë—ã—Å—Ç—Ä—ã–π reset

–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ
docker-compose down -v

# –£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–∑—ã
docker rmi telegram-audio-bot:2.5 aiogram/telegram-bot-api

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
docker-compose up -d --build
```

–≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏!
